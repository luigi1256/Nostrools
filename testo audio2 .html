<!DOCTYPE html>
<html>
  <head>
    <title>Sottotitoli dell'audio</title>
    <script src="https://cdn.jsdelivr.net/npm/webvtt/dist/webvtt.min.js"></script>
  </head>
  <body>
    <h1>Sottotitoli dell'audio</h1>
    <audio controls id="audio_player"></audio>
    <div id="subtitles"></div>
    <script>
      // leggi i dati dei file audio e di testo
      const urlParams = new URLSearchParams(window.location.search);
      const audioFile = urlParams.get('audio_file');
      const textFile = urlParams.get('testo_file');
      
      // carica il file audio e avvia la riproduzione
      const audioPlayer = document.getElementById('audio_player');
      audioPlayer.src = audioFile;
      audioPlayer.load();
      audioPlayer.play();
      
      // carica il file di testo e visualizza i sottotitoli
      fetch(textFile)
        .then(response => response.text())
        .then(text => {
          const cues = WebVTT.parse(text);
          const subtitleDisplay = document.getElementById('subtitles');
          const subtitleCues = cues.cues;
          let currentCueIndex = 0;
          audioPlayer.addEventListener('timeupdate', () => {
            const currentTime = audioPlayer.currentTime;
            const currentCue = subtitleCues[currentCueIndex];
            if (currentCue && currentTime >= currentCue.startTime && currentTime <= currentCue.endTime) {
              subtitle              subtitleDisplay.innerHTML = currentCue.text;
            } else {
              subtitleDisplay.innerHTML = '';
            }
            if (currentCue && currentTime >= currentCue.endTime) {
              currentCueIndex++;
            }
          });
        });
    </script>
  </body>
</html>
